#!/bin/sh
set -e

echo "··························································································"
echo "MARTIN VILCHE"
echo "··························································································"

if [ -z "$CRONTAB" ]; then
echo "···································································································"
echo "VARIABLE CRONTAB NO ENCONTRADA - ERROR"
echo "···································································································"
echo "DEBE INGRESAR LA VARIABLE CRONTAB PARA DEFINIR LAS TAREAS PROGRAMADAS"
echo "EJEMPLO: 0 5 * * 1 touch hola.txt"
echo "···································································································"
exit 1
else
echo "···································································································"
echo "VARIABLE CRONTAB ENCONTRADO"
echo "$CRONTAB"
echo "$CRONTAB" > /cron.d/crontab
echo "···································································································"
fi



if [ -z "$USERID" ]; then
USERID=1001
echo "···································································································"
echo "VARIABLE USERID NO ENCONTRADO USANDO POR DEFECTO " $USERID
echo "···································································································"
else
echo "···································································································"
echo "VARIABLE USERID ENCONTRADO: " $USERID
echo "···································································································"
fi

if [ -z "$TIMEZONE" ]; then
echo "···································································································"
echo "VARIABLE TIMEZONE NO SETEADA - INICIANDO CON VALORES POR DEFECTO"
echo "POSIBLES VALORES: America/Montevideo | America/El_Salvador"
echo "···································································································"
else
echo "···································································································"
echo "TIMEZONE SETEADO ENCONTRADO: " $TIMEZONE
echo "···································································································"
echo "SETEANDO TIMEZONE...."
su-exec $USERID cat /usr/share/zoneinfo/$TIMEZONE > /etc/localtime

if [ $? -eq 0 ]; then
echo "···································································································"
echo "TIMEZONE SETEADO CORRECTAMENTE"
echo "···································································································"
else

echo "···································································································"
echo "ERROR AL SETEAR EL TIMEZONE - SALIENDO"
echo "···································································································"
exit 1
fi
fi

chown $USERID:$USERID -R /cron.d
echo "INICIANDO CRON..."
exec su-exec $USERID go-crond --allow-unprivileged --no-auto --default-user=$USERID --verbose "$@"
